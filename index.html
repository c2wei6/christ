<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
	<title>圣诞活动</title>
	<script type="text/javascript">
	    document.documentElement.style.fontSize = document.documentElement.clientWidth / 10 + 'px';
	</script>
	<link rel="stylesheet" type="text/css" href="style.css?v=1.2">
</head>
<body>
    <div id="des">
        <h1>玩法介绍</h1>
        <p>圣诞节到了，预示着新的一年即将到来，许一个圣诞愿望，记在心里，然后翻开一张卡片，看看圣诞老人的祝福吧！也许会收到圣诞老人准备的精美礼物哦～</p>
        <div class="button">开始</div>
    </div>
    <div id="share"></div>
    <div class="result-wrap">
        <div id="result">
            <h1>祝福</h1>
            <p id="resmsg"></p>
            <button class="res-btn" id="reset">再来一次</button>
            <button class="res-btn" id="share-btn">分享给朋友</button>
        </div>
    </div>
    <div class="wrap" id="wrap">
        <!-- <div class="clearfix"></div> -->
    </div>
    <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript">
    var global_info = [];
    $(function () {
        //说明界面隐藏
        $('#des>.button').click(function () {
            $(this).parent().hide();
        })
        // 数据初始化
        var url = 'lib.php';
        var data = {a: 1, id: 1};
        $.get(url, data, function (responsive, status) {
            var res = JSON.parse(responsive);
            if (res.code == 200) {
                global_info = res.msg;
                var $frontArr = $(".front");
                for (var i = 0; i < res.msg.length; i ++) {
                    $($frontArr[i]).html(global_info[i]);
                }
            }
        });
        //再来一次
        $("#reset").click(function () {
            window.location.reload();
        })
        // 分享界面展示
        $("#share-btn").click(function () {
            $("#share").show();
        })
        $("#share").click(function () {
            $(this).hide();
        })
    })
    $(function () {
        // 拼接所有卡片
        var wrap = document.querySelector('.wrap');
        var n = 9;
        var data = '测试文字';
        for (var i = 0; i < n; i ++) {
            id = i;
            
            var div1 = document.createElement('div');
            var div2 = document.createElement('div');
            var div3 = document.createElement('div');

            var text = document.createTextNode(data);

            div1.setAttribute('class', 'card left');
            div1.setAttribute('data-id', id);
            div2.setAttribute('class', 'front front2');
            if (i%2 == 0) {
                div3.setAttribute('class', 'backd backd4');
            } else {
                div3.setAttribute('class', 'backd backd5');
            }

            div2.innerHTML = '';

            div2.appendChild(text);

            div1.appendChild(div2);
            div1.appendChild(div3);

            var clearfix = document.createElement('div');
            clearfix.setAttribute('class', 'clearfix');
            wrap.appendChild(div1);
        }
        wrap.appendChild(clearfix);

        //3d翻转函数    
        var rotate = function(obj, deg, xy) {
            obj.style.transform = 'rotate' + xy + '(' + deg + 'deg)';
        }
        //抓取所有card
        var wrap = document.getElementById('wrap');
        var cardArr = document.querySelectorAll('.card');
        //结果展示函数
        var result = document.getElementById('result');
        var showresult = function (index) {
            $("#resmsg").html(global_info[index]);
            result.style.top = '3rem';
            // result.styurl('img/card/front1.png')
            result.parentNode.style.height = '100%';
            wrap.removeEventListener('click', event);
        }
        //给每个card设定翻转
        var event = function (e) {
            var tar = e.target;
            tar = (tar.getAttribute('class').indexOf('backd') != -1 || tar.getAttribute('class').indexOf('front') != -1 ) ? tar.parentNode : tar;
            rotate(tar.getElementsByClassName('front')[0], 0, 'Y');
	    	rotate(tar.getElementsByClassName('backd')[0], 180, 'Y');
	    	setTimeout(function() {
	    		showresult(tar.getAttribute('data-id'));
	    	}, 800);
		}
		wrap.addEventListener('click', event);   
    });
    </script>
</body>
</html>