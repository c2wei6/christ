<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
	<title>圣诞活动</title>
	<script type="text/javascript">
	    document.documentElement.style.fontSize = document.documentElement.clientWidth / 10 + 'px';
	</script>
	<link rel="stylesheet" type="text/css" href="css/main.css?v=2.0">
</head>
<body>
    <!-- 玩法简介 -->
    <div class="back" id="des">
        <h1>玩法介绍</h1>
        <p>圣诞节到了<br>
            预示着新的一年即将到来<br>
            许一个圣诞愿望，记在心里<br>
            然后翻开一张卡片<br>
            看看圣诞老人的回答吧！<br>
            也许会收到圣诞老人的礼物哦～<br>
            注：玩法同《答案之书》<br>
            纯属娱乐</p>
        <div class="btn btn-lg">开始</div>
    </div>
    <!-- 分享给朋友 -->
    <div class="back" id="share"></div>
    <!-- 抽奖页 -->
    <div class="back" id="draw">
        <div class="draw">    
            <p>恭喜你获得了抽奖机会！</p>
            <p>（只会获得一次）</p>
            <button id="draw-btn" class="btn btn-lg">点我抽奖</button>
        </div>
    </div>
    <!-- 提交信息 -->
    <div class="back" id="post">
        <div class="form">
            <input id="name" type="text" name="" placeholder="输入姓名">
            <input id="phone" type="text" name="" placeholder="输入手机号">
            <input id="address" type="text" name="" placeholder="输入宿舍号">
            <button id="submit">提交</button>
        </div>
    </div>
    <!-- 写信 -->
    <div id="message"></div>
    <!-- 答案详情 -->
    <div class="result-wrap">
        <div id="result">
            <h1>解答</h1>
            <p id="resmsg"></p>
            <button class="btn btn-sm" id="reset">再来一次</button>
            <button class="btn btn-sm" id="share-btn">分享给朋友</button>
        </div>
    </div>
    <!-- 卡片 -->
    <div class="wrap" id="wrap">
        <!-- <div class="clearfix"></div> -->
    </div>
    <script src="js/jquery.min.js"></script>
    <script src="js/layer.js"></script>
    <script type="text/javascript">
    var global_info = [];
    $(function () {
        $('html').height($(window).height());
        //说明界面隐藏
        $('#des>.btn').click(function () {
            $(this).parent().hide();
        })
        // 数据初始化
        var url = 'lib.php';
        var data = {a: 1, id: 1};
        $.get(url, data, function (responsive, status) {
            var res = JSON.parse(responsive);
            if (res.code == 200) {
                global_info = res.msg;
                var $frontArr = $(".front");
                for (var i = 0; i < res.msg.length; i ++) {
                    $($frontArr[i]).html(global_info[i]);
                }
            } else {
                layer.open({
                    content: res.err,
                    btn: "知道了"
                });
            }
        });
        //再来一次
        $("#reset").click(function () {
            window.location.reload();
        })
        // 分享界面展示
        $("#share-btn").click(function () {
            $("#share").show();
        })
        $("#share").click(function () {
            $(this).hide();
        })
    })
    //抽奖部分
    $(function () {
        var token = null;
        $("#draw-btn").click(function () {
            var load = layer.open({type:2});
            var url = 'lib.php?a=2';
            setTimeout(function () {
                $.get(url, {}, function (responsive, status) {
                    layer.close(load);
                    var res = JSON.parse(responsive);
                    if (res.code == 200) {
                        token = res.token;
                        layer.open({content: "恭喜你抽中了一枚圣诞果,请留下联系方式,我们会送到床边~", btn: "知道了"});
                        $("#post").show();
                        $("#draw").hide();
                    } else {
                        layer.open({
                            content: res.err,
                            btn: "知道了"
                        });
                        $("#draw").hide();
                    }
                })
            }, 1000);
        });
        token = 1;
        $("#submit").click(function () {
            if (token == null) {
                layer.open({
                    content: "不正当操作",
                    btn: "知道了"
                });
                return;
            }

            var name = $("#name").val();
            var phone = $("#phone").val();
            var address = $("#address").val();

            if (!name || !phone || !address) {
                layer.open({
                    content: "信息不能为空",
                    btn: "知道了"
                });
                return false;
            }

            var url = 'lib.php?a=3';

            var data = {
                token: token,
                name: name,
                phone: phone,
                address: address
            }

            $.post(url, data, function (responsive, status) {
                var res = JSON.parse(responsive);
                console.log(res);
                if (res.code == 200) {
                    layer.open({content: res.msg, skin: 2, time: 2});
                    $("#post").hide();
                } else {
                    layer.open({
                        content: res.err,
                        btn: "知道了"
                    })
                }
            });
        })
    })
    $(function () {
        // 拼接所有卡片
        var wrap = document.querySelector('.wrap');
        var n = 9;
        var data = '测试文字';
        for (var i = 0; i < n; i ++) {
            id = i;
            
            var div1 = document.createElement('div');
            var div2 = document.createElement('div');
            var div3 = document.createElement('div');

            var text = document.createTextNode(data);

            div1.setAttribute('class', 'card left');
            div1.setAttribute('data-id', id);
            div2.setAttribute('class', 'front');
            if (i%2==0 && i!=4) {
                div3.setAttribute('class', 'backd backd1');
            } else if (i == 4) {
                div3.setAttribute('class', 'backd backd3');                
            } else {
                div3.setAttribute('class', 'backd backd2');
            }

            div2.innerHTML = '';

            div2.appendChild(text);

            div1.appendChild(div2);
            div1.appendChild(div3);

            var clearfix = document.createElement('div');
            clearfix.setAttribute('class', 'clearfix');
            wrap.appendChild(div1);
        }
        wrap.appendChild(clearfix);

        //3d翻转函数    
        var rotate = function(obj, deg, xy) {
            obj.style.transform = 'rotate' + xy + '(' + deg + 'deg)';
        }
        //抓取所有card
        var wrap = document.getElementById('wrap');
        var cardArr = document.querySelectorAll('.card');
        //结果展示函数
        var result = document.getElementById('result');
        var showresult = function (index) {
            $("#resmsg").html(global_info[index]);
            result.style.top = '3rem';
            // result.styurl('img/card/front1.png')
            result.parentNode.style.height = '100%';
            if (localStorage.draw == undefined || localStorage.draw == false) {
                localStorage.draw = true;
                if (Math.random() > 0.7) {
                    setTimeout(function () {
                        $("#draw").show();
                    }, 2000);
                }
            }

            wrap.removeEventListener('click', event);

        }
        //给每个card设定翻转
        var event = function (e) {
            var tar = e.target;
            tar = (tar.getAttribute('class').indexOf('backd') != -1 || tar.getAttribute('class').indexOf('front') != -1 ) ? tar.parentNode : tar;
            rotate(tar.getElementsByClassName('front')[0], 0, 'Y');
	    	rotate(tar.getElementsByClassName('backd')[0], 180, 'Y');
	    	setTimeout(function() {
	    		showresult(tar.getAttribute('data-id'));
	    	}, 800);
		}
		wrap.addEventListener('click', event);   
    });
    </script>
</body>
</html>